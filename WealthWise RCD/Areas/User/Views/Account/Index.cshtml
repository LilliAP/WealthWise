@using Microsoft.AspNetCore.Identity
@using WealthWise_RCD.Models
@using WealthWise_RCD.Models.DatabaseModels
@using WealthWise_RCD.Services
@inject UserManager<ApplicationUser> UserManager
@inject UserService UserService
@{
    var links = new List<SidebarLink>
    {
        new SidebarLink{Title = "Profile", Url = Url.Action("LoadProfilePartial", "Account", new {AreaAttribute = "User"})!},
        new SidebarLink{Title = "Appointments", Url = Url.Action("LoadAppointmentsPartial", "Account", new {AreaAttribute = "User"})!},
        new SidebarLink{Title = "Subscription", Url = Url.Action("LoadSubscriptionPartial", "Account", new {AreaAttribute = "User"})!},
        new SidebarLink{Title = "Saved Payment Methods", Url = Url.Action("LoadPaymentMethodsPartial", "Account", new {AreaAttribute = "User"})!}
    };
    ApplicationUser currentUser = await UserManager.GetUserAsync(User);
    var getAddress = UserService.GetAddressAsync(currentUser);
    getAddress.Wait();
    currentUser.Address = getAddress.Result;
}

<!-- Link for the font awesome library -->
<head>
    <script src="https://kit.fontawesome.com/32c95df022.js" crossorigin="anonymous"></script>
</head>

<!-- Bootstrap Sidebar (Always Visible) -->
<div class="d-flex">
    <nav class="sidebar">
        <h1 style="-webkit-text-fill-color: #673636; padding-left: 11px;">My Account</h1>
        @foreach (var link in links)
        {
            <a href="#" class="d-block py-2" onclick="loadPartial('@link.Url')">
                @link.Title
            </a>
        }
    </nav>

    <!-- Container for dynamic content -->
    <div id="content-container" class="flex-grow-1 p-4">
        <partial name="Account/_ProfilePartial" for="@currentUser" />
    </div>
</div>

<script>
    window.addEventListener('DOMContentLoaded', () => {
        const navbar = document.querySelector('.navbar');
        const footer = document.querySelector('.footer');
        const sidebar = document.querySelector('.sidebar');
        const content = document.querySelector('.content-wrapper');

        function adjustLayout() {
            const navbarHeight = navbar.offsetHeight;
            const footerHeight = footer.offsetHeight;
            // Adjust the sidebar and content margin based on navbar height
            sidebar.style.top = `${navbarHeight}px`;
            sidebar.style.height = `calc(100vh - ${navbarHeight}px - ${footerHeight}px)`;
            content.style.marginTop = `${navbarHeight}px`;
            // Adjust the sidebar and content margin based on navbar height
            sidebar.style.bottom = `${footerHeight}px`;
            content.style.marginBottom = `${footerHeight}px`;
        }

        // Run on load and on resize
        adjustLayout();
        window.addEventListener('resize', adjustLayout);
    });
</script>

<!-- Dynamically loads main content -->
<script>
    function loadPartial(url) {
        fetch(url, {
            method: 'GET',
            headers: {
                'X-Requested-With': 'XMLHttpRequest'
            }
        })
        .then(response => response.text())
        .then(html => {
            document.getElementById('content-container').innerHTML = html;
        })
        .catch(error => console.error('Error loading content:', error));
    }
</script>

<style>
    /* Sidebar Styling */
    nav.sidebar {
        background-color: #f9f8f5; /* Light Bootstrap background */
        width: 350px;
        border-right: 1px solid #ddd; /* Subtle border */
        padding: 20px;
        position: absolute; /* Fix it to the left */
        top: 0;
        left: 0;
        overflow-y: auto; /* Scroll if content overflows */
    }

        /* Sidebar Links */
        nav.sidebar a {
            display: block;
            color: #673636;
            text-decoration: none;
            text-align: left;
            font-size: 24px;
            padding: 10px 15px;
            border-radius: 5px;
            transition: background 0.3s ease;
        }

            nav.sidebar a:hover {
                background-color: #adad85; /* Bootstrap primary color */
                color: white;
            }

    /* Main Content Area */
    #content-container {
        margin-left: 270px; /* Offset to match sidebar width */
        padding: 20px;
    }

</style>
